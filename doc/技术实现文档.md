# Offer贝 - 技术实现文档

## 一、项目概述

Offer贝是一个基于 AI 的智能面试辅助系统，采用前后端分离架构。后端使用 Flask 框架提供 RESTful API，前端使用 Vue 3 框架构建现代化的单页应用。系统集成了 DeepSeek 大语言模型、阿里云语音识别服务，实现了完整的用户认证、简历分析、面试准备等功能，并支持中英双语。

### 核心技术亮点

- **前后端分离架构**  可独立部署和扩展
- **JWT 无状态认证** - 支持跨设备数据同步
- **AI 大模型集成** - DeepSeek API 提供智能分析
- **实时语音识别** - 阿里云 ASR WebSocket 转写
- **国际化支持** - Vue I18n + 后端 Prompt 多语言版本
- **并发优化** - 批量并发调用，提升生成效率
- **响应式设计** - 完美适配桌面和移动设备

## 二、数据库设计

### 2.1 用户表（users）

| 字段名 | 数据类型 | 约束 | 描述 |
| --- | --- | --- | --- |
| id | VARCHAR(36) | PRIMARY KEY | 用户唯一标识（UUID） |
| user_id | VARCHAR(36) | UNIQUE | JWT Token 中的用户 ID |
| email | VARCHAR(120) | UNIQUE, NOT NULL | 邮箱（登录凭据） |
| password | VARCHAR(255) | NOT NULL | 加密后的密码（Werkzeug + bcrypt） |
| email_verified | BOOLEAN | DEFAULT FALSE | 邮箱验证状态 |
| verification_code | VARCHAR(6) | NULL | 邮箱验证码 |
| verification_code_expiry | DATETIME | NULL | 验证码过期时间（15分钟） |
| reset_password_token | VARCHAR(100) | NULL | 密码重置令牌 |
| reset_password_expiry | DATETIME | NULL | 重置令牌过期时间（24小时） |
| login_attempts | INT | DEFAULT 0 | 登录尝试次数 |
| locked_until | DATETIME | NULL | 账号锁定时间（5次失败后锁定5分钟） |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**设计亮点**：
- user_id 字段用于关联其他表，与 JWT Token 中的 user_id 对应
- 邮箱验证和密码重置流程完整
- 防暴力破解机制完善

### 2.2 简历表（resumes）

| 字段名 | 数据类型 | 约束 | 描述 |
| --- | --- | --- | --- |
| id | VARCHAR(36) | PRIMARY KEY | 简历记录 ID |
| resume_id | VARCHAR(8) | UNIQUE | 简历唯一标识 |
| user_id | VARCHAR(36) | FOREIGN KEY | 关联用户 ID |
| original_content | TEXT | | 原始简历文本（PDF 提取） |
| optimized_content | TEXT | | 优化后的简历（Markdown 格式） |
| score | INT | | 简历综合评分（0-100） |
| diagnosis | JSON | | 智能诊断结果（警告/错误/建议） |
| keywords | JSON | | 提取的关键词列表 |
| star_rewrite | JSON | | STAR 法则重写建议 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**设计亮点**：
- 同时保存原始和优化简历
- JSON 字段存储复杂的分析结果
- score 字段方便快速查询和排序

### 2.3 自我介绍表（self_intros）

| 字段名 | 数据类型 | 约束 | 描述 |
| --- | --- | --- | --- |
| id | VARCHAR(36) | PRIMARY KEY | 记录 ID |
| user_id | VARCHAR(36) | FOREIGN KEY | 关联用户 ID |
| resume_id | VARCHAR(8) | | 关联的简历 ID |
| self_intro_type | VARCHAR(50) | | 类型（如"30秒电梯演讲版_正式"） |
| content | TEXT | | 自我介绍内容 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**设计亮点**：
- self_intro_type 字段标准化存储版本和风格
- 支持历史记录查询和版本对比

### 2.4 智能题库表（question_banks）

| 字段名 | 数据类型 | 约束 | 描述 |
| --- | --- | --- | --- |
| id | VARCHAR(36) | PRIMARY KEY | 题库 ID |
| user_id | VARCHAR(36) | FOREIGN KEY | 关联用户 ID |
| resume_id | VARCHAR(8) | | 关联的简历 ID |
| count | INT | | 题目数量（10/30/50） |
| questions | JSON | | 问题列表（含答案和意图） |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**设计亮点**：
- JSON 字段存储完整的题库数据
- count 字段快速标识题库规模

### 2.5 模拟面试表（mock_interviews）

| 字段名 | 数据类型 | 约束 | 描述 |
| --- | --- | --- | --- |
| id | VARCHAR(36) | PRIMARY KEY | 面试 ID |
| user_id | VARCHAR(36) | FOREIGN KEY | 关联用户 ID |
| resume_id | VARCHAR(8) | | 关联的简历 ID |
| style | VARCHAR(50) | | 面试官风格 |
| duration | INT | | 面试时长（分钟） |
| conversation_history | JSON | | 对话历史记录 |
| question_answers | JSON | | 问答记录（结构化） |
| report | JSON | | 面试报告（评分 +分析） |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**设计亮点**：
- conversation_history 保存完整对话流
- question_answers 结构化存储便于报告生成
- report 字段存储评估结果

### 2.6 面试策略表（interview_strategies）

| 字段名 | 数据类型 | 约束 | 描述 |
| --- | --- | --- | --- |
| id | VARCHAR(36) | PRIMARY KEY | 策略 ID |
| user_id | VARCHAR(36) | FOREIGN KEY | 关联用户 ID |
| resume_id | VARCHAR(8) | | 关联的简历 ID |
| type | VARCHAR(20) | | 策略类型（analysis/questions） |
| background_info | TEXT | | 背景信息 |
| directions | JSON | | 优化方向列表 |
| company_name | VARCHAR(100) | | 目标公司 |
| position | VARCHAR(100) | | 目标岗位 |
| question_types | JSON | | 问题类型列表 |
| result | JSON | | 生成结果 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**设计亮点**：
- type 字段区分画像分析和反问问题
- 灵活的 JSON 字段适应不同类型的策略数据

#### 3.2.2 登录功能

- 邮箱密码验证
- 登录尝试次数限制
- 账号锁定机制（5次失败尝试后锁定5分钟）
- 记住我功能支持
- JWT令牌生成

#### 3.2.3 密码重置功能

- 重置链接生成与发送
- 重置链接有效期管理（24小时）
- 密码更新功能

### 3.3 API端点

| 端点 | 方法 | 功能描述 |
| --- | --- | --- |
| /api/auth/send-verification-code | POST | 发送邮箱验证码 |
| /api/auth/register | POST | 用户注册 |
| /api/auth/login | POST | 用户登录 |
| /api/auth/refresh | POST | 刷新JWT令牌 |
| /api/auth/request-reset-password | POST | 请求重置密码 |
| /api/auth/reset-password | POST | 重置密码 |

### 3.4 安全机制

- 密码使用bcrypt加密存储
- JWT令牌认证
- 防暴力破解机制
- HTTPS传输（建议生产环境使用）

## 四、前端实现

### 4.1 技术栈

- Vue 3
- Vue Router 4
- Axios

### 4.2 核心功能实现

#### 4.2.1 登录页面

- 邮箱密码登录表单
- 表单实时验证
- 记住我选项
- 忘记密码链接
- 注册链接

#### 4.2.2 注册页面

- 邮箱验证码注册表单
- 邮箱格式验证
- 密码强度提示
- 验证码发送与倒计时功能（15分钟）
- 实时表单验证

#### 4.2.3 密码重置功能

- 密码重置请求页面
- 重置密码页面
- 表单验证

### 4.3 路由配置

| 路由 | 组件 | 功能描述 |
| --- | --- | --- |
| /login | LoginView | 登录页面 |
| /register | RegisterView | 注册页面 |
| /forgot-password | ForgotPasswordView | 密码重置请求页面 |
| /reset-password | ResetPasswordView | 密码重置页面 |

### 4.4 前端验证规则

- 邮箱格式验证
- 密码强度验证（至少8位，包含大小写字母、数字和特殊符号）
- 必填项检查
- 实时反馈

## 五、系统流程

### 5.1 注册流程

1. 用户访问注册页面
2. 输入邮箱、密码和验证码
3. 前端验证表单数据
4. 点击"获取验证码"按钮，系统发送验证码到用户邮箱
5. 用户输入验证码
6. 点击"注册"按钮，系统验证验证码并创建用户
7. 注册成功后，系统生成JWT令牌并跳转到首页

### 5.2 登录流程

1. 用户访问登录页面
2. 输入邮箱和密码
3. 前端验证表单数据
4. 点击"登录"按钮，系统验证用户凭据
5. 登录成功后，系统生成JWT令牌并跳转到首页
6. 登录失败时，系统记录失败次数，超过限制则锁定账号

### 5.3 密码重置流程

1. 用户访问忘记密码页面
2. 输入注册邮箱
3. 点击"发送重置链接"按钮，系统发送重置链接到用户邮箱
4. 用户点击邮件中的重置链接
5. 跳转到密码重置页面，输入新密码
6. 点击"重置密码"按钮，系统更新密码
7. 密码重置成功后，系统提示用户并跳转到登录页面

## 六、测试建议

### 6.1 功能测试

- 注册流程测试
- 登录流程测试（包括记住我功能）
- 密码重置流程测试
- 验证码有效期测试
- 登录尝试次数限制测试

### 6.2 安全性测试

- 密码加密存储测试
- JWT令牌安全性测试
- 防暴力破解测试

### 6.3 性能测试

- 并发登录测试
- 验证码发送性能测试

## 七、部署建议

### 7.1 环境配置

- 设置环境变量JWT_SECRET_KEY，使用强随机字符串
- 配置MAIL_SERVER、MAIL_PORT、MAIL_USERNAME和MAIL_PASSWORD
- 设置HTTPS证书，确保所有请求通过HTTPS传输

### 7.2 生产环境优化

- 配置数据库连接池
- 使用Redis存储验证码和重置链接，提高性能
- 配置日志记录，便于监控和调试
- 设置定期清理过期验证码和重置链接的任务

## 八、后续优化建议

1. 添加社交登录功能（微信、QQ、GitHub等）
2. 实现双因素认证
3. 添加用户头像上传功能
4. 实现用户信息管理功能
5. 添加登录日志记录
6. 实现更细粒度的权限控制

## 九、文件结构

```
backend/
├── app/
│   ├── __init__.py          # 应用初始化
│   ├── models.py            # 数据库模型
│   ├── routes/
│   │   ├── __init__.py      # 路由初始化
│   │   └── auth.py          # 认证相关API
│   └── utils/
│       └── jwt_utils.py     # JWT工具类
├── config.py                # 配置文件
├── requirements.txt         # 依赖列表
└── run.py                   # 应用入口

src/
├── views/
│   ├── LoginView.vue        # 登录页面
│   ├── RegisterView.vue     # 注册页面
│   ├── ForgotPasswordView.vue # 密码重置请求页面
│   └── ResetPasswordView.vue # 密码重置页面
├── router/
│   └── index.js             # 路由配置
└── utils/
    └── api.js               # API客户端
```

## 十、总结

本用户认证系统实现了完整的注册、登录和密码重置功能，具有良好的安全性和用户体验。系统采用了前后端分离架构，便于维护和扩展。通过使用bcrypt加密存储密码、JWT令牌认证和防暴力破解机制，确保了系统的安全性。前端实现了实时表单验证、密码强度提示和验证码倒计时功能，提供了良好的用户体验。