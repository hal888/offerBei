# AI智能面试宝典 安全分析报告

## 1. 项目概述
这是一个基于AI技术的面试辅助系统，包含前端（Vue 3）和后端（Flask）组件，主要功能包括简历优化、自我介绍生成、智能题库、模拟面试和面试策略生成。

## 2. 安全架构分析

### 2.1 认证机制
- **当前实现**：无传统认证系统，使用简单的userId机制
- **实现细节**：
  - 前端将userId存储在localStorage中
  - 后端在首次请求时生成UUID并返回给前端
  - `User`模型使用`user_id`字段标识用户，无密码字段
  - 所有API请求需携带userId，但缺乏验证机制

### 2.2 授权机制
- **资源访问控制**：通过userId关联用户与资源
- **实现方式**：
  - 数据库模型（Resume、SelfIntro等）包含`user_id`外键
  - API端点检查资源是否属于请求用户
  - 示例：`Resume.query.filter_by(resume_id=resume_id, user_id=user.id)`

### 2.3 CORS配置
- **使用库**：`flask_cors`
- **当前设置**：默认配置，允许所有源、方法和头
- **安全隐患**：在生产环境中过于宽松，可能导致跨站请求伪造（CSRF）攻击

### 2.4 API安全
- **请求验证**：基本的必填字段检查
- **速率限制**：无
- **CSRF保护**：无
- **输入验证**：
  - 文件上传仅检查文件存在和文件名非空
  - 无深度输入验证或净化
  - 无XSS防护机制

### 2.5 数据安全
- **数据库连接**：硬编码数据库凭据
- **文件存储**：简历文件存储在磁盘（resumes/original/和resumes/optimized/）
  - 使用UUID命名避免冲突
  - 无文件加密
- **敏感数据**：DeepSeek API密钥硬编码在配置文件中

### 2.6 配置管理
- **配置文件**：所有配置硬编码在`config.py`
- **环境变量**：无环境变量支持
- **环境分离**：无生产/开发环境配置分离

## 3. 主要安全漏洞

### 3.1 硬编码敏感信息
**风险级别：高危**
- **问题**：配置文件中硬编码DeepSeek API密钥、数据库用户名和密码
- **位置**：`backend/config.py:8-24`
- **影响**：泄露API密钥和数据库凭据，攻击者可滥用API服务和访问数据库
- **修复建议**：使用环境变量或加密配置文件存储敏感信息

### 3.2 不安全的CORS配置
**风险级别：中危**
- **问题**：使用`CORS(app)`默认配置，允许所有来源访问
- **位置**：`backend/app.py:14`
- **影响**：跨域资源共享过于宽松，可能导致CSRF攻击和敏感数据泄露
- **修复建议**：限制允许的来源域名，配置适当的HTTP方法和头

### 3.3 缺乏身份验证机制
**风险级别：高危**
- **问题**：仅使用简单的userId机制，无密码或令牌验证
- **影响**：攻击者可通过伪造userId访问他人数据
- **修复建议**：实现JWT或OAuth2认证机制，添加密码验证

### 3.4 文件上传安全问题
**风险级别：中危**
- **问题**：`/api/resume/analyze`端点允许文件上传，但缺乏严格验证
- **位置**：`backend/app.py:254-288`
- **影响**：可能导致恶意文件上传、服务器资源耗尽或代码执行漏洞
- **修复建议**：添加文件类型、大小验证，存储在非Web根目录

### 3.5 缺乏输入验证和数据清理
**风险级别：中危**
- **问题**：API端点接受用户输入但缺乏严格验证和清理
- **影响**：可能导致注入攻击、XSS攻击等
- **修复建议**：对所有用户输入进行验证、清理和转义

### 3.6 敏感信息日志泄露
**风险级别：中危**
- **问题**：代码中直接将敏感信息（如文件内容、API响应）输出到日志或文件
- **位置**：`backend/app.py:51, 281, 282, 328`
- **影响**：可能泄露用户敏感数据
- **修复建议**：移除敏感信息的日志记录，仅记录必要的非敏感日志

### 3.7 缺乏错误处理机制
**风险级别：中危**
- **问题**：错误处理不完善，可能泄露系统内部信息
- **影响**：攻击者可通过错误信息了解系统结构
- **修复建议**：实现统一错误处理，不暴露敏感的系统信息

### 3.8 前端路由保护薄弱
**风险级别：中危**
- **问题**：使用localStorage `resumeId`检查来保护路由，容易被绕过
- **位置**：`src/router/index.js:40-58`
- **影响**：恶意用户可通过修改localStorage访问受保护路由
- **修复建议**：实现真正的身份验证机制，结合后端验证

### 3.9 API通信不安全
**风险级别：中危**
- **问题**：API调用使用HTTP而非HTTPS，代理配置禁用SSL验证
- **位置**：`vite.config.js:15-17`
- **影响**：数据传输可被窃听或篡改
- **修复建议**：生产环境使用HTTPS，启用SSL验证

### 3.10 缺乏CSRF保护
**风险级别：中危**
- **问题**：API请求未实现CSRF令牌或其他保护机制
- **影响**：允许跨站请求伪造攻击
- **修复建议**：实现CSRF令牌机制或SameSite cookie策略

### 3.11 潜在XSS漏洞
**风险级别：中危**
- **问题**：缺乏输入验证和输出编码机制，使用`marked`库可能存在风险
- **影响**：攻击者可注入恶意脚本
- **修复建议**：配置`marked`库的XSS防护选项，对所有用户输入进行验证和清理

## 4. 安全修复建议

### 4.1 配置管理改进
- 使用环境变量存储敏感信息（API密钥、数据库凭据等）
- 实现不同环境的配置文件（开发、测试、生产）
- 示例修复：
  ```python
  import os
  DEEPSEEK_CONFIG = {
      "api_key": os.environ.get("DEEPSEEK_API_KEY", ""),
      "base_url": os.environ.get("DEEPSEEK_BASE_URL", "https://api.deepseek.com/v1"),
      "model": os.environ.get("DEEPSEEK_MODEL", "deepseek-chat")
  }
  ```

### 4.2 强化CORS配置
- 限制允许的来源域名
- 示例修复：
  ```python
  from flask_cors import CORS
  CORS(app, origins=["https://interview.ailongdev.com", "http://localhost:5173"])
  ```

### 4.3 实现身份验证机制
- 添加JWT或OAuth2认证
- 为API请求添加认证头
- 实现密码重置和找回功能

### 4.4 加强文件上传安全
- 验证文件类型（通过MIME类型和扩展名双重验证）
- 限制文件大小
- 存储在非Web根目录
- 实现内容验证，防止恶意文件

### 4.5 实现输入验证和数据清理
- 对所有用户输入进行严格验证
- 对输出内容进行适当转义，防止XSS攻击
- 使用参数化查询防止SQL注入

### 4.6 添加API速率限制
- 使用Flask-Limiter等库实现基于IP或用户的速率限制
- 防止API滥用和DDoS攻击

### 4.7 修复前端路由保护
- 替换localStorage-based保护，使用真实的认证机制
- 在路由导航前验证用户身份

### 4.8 启用HTTPS通信
- 生产环境使用HTTPS进行API通信
- 移除SSL验证禁用配置

### 4.9 添加CSRF保护
- 为所有状态变更API实现CSRF令牌
- 设置适当的SameSite cookie属性

### 4.10 安全依赖管理
- 定期更新依赖项，修复已知安全漏洞
- 使用依赖扫描工具检查漏洞
- 示例：`npm audit` 或 `pip-audit`

## 5. 结论

该项目目前采用了简单的安全设计，适合开发和测试环境使用，但在生产环境部署前需要进行全面的安全强化。主要风险包括敏感信息泄露、缺乏身份验证、不安全的CORS配置和文件上传处理。通过实施上述安全建议，可以显著降低系统遭受攻击的风险，保护用户数据安全和系统稳定性。

建议按照风险优先级逐步实施修复，首先解决硬编码敏感信息和缺乏身份验证这两个高危问题，然后依次处理其他中危问题。